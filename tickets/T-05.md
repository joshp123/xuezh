---
id: T-05
title: Snapshot command v1 (bounded context pack for planning)
order: 5
depends_on: ["T-04"]
blocks: ["T-10", "T-11", "T-14"]
implements_commands: ["snapshot"]
user_requirements: ["UR-01", "UR-03", "UR-08", "UR-09"]
bdd: ["BDD-ZFC", "BDD-REVIEW", "BDD-HSK"]
north_stars: ["NS-1", "NS-2", "NS-3"]
status: done
---
    # T-05: Snapshot command v1 (bounded context pack for planning)

    ## Goal
    Produce a bounded JSON snapshot used by the model to make lesson plans.

    ## Deliverables
    - `xuezh snapshot --window 30d --due-limit N --evidence-limit M --max-bytes K`
- Snapshot includes facts only:
  - due items list (deterministic order)
  - upcoming due counts by day
  - HSK coverage summary
  - recent pronunciation trend summary (if present)
  - recent events pointer (artifact path to ndjson)


    ## Acceptance criteria
    - Snapshot output is deterministic for same DB state
- Snapshot never contains recommendation fields
- Output is bounded (spills to artifact if too large)


    ## Test plan (RGR)
    - E2E: create DB state and snapshot; validate keys and determinism
- Integration: enforce forbidden keys absent (BDD-ZFC)


## Notes
Implemented snapshot with bounded output, workspace-safe artifact spill, and deterministic output with fixed clock.
Added integration test using fixture datasets for HSK summary counts.
