---
id: T-01
title: CLI contract: JSON envelope, typed errors, JSON Schemas, bounded output conventions
order: 1
depends_on: ["T-00"]
blocks: ["T-05", "T-06", "T-07", "T-08", "T-09", "T-10"]
user_requirements: ["UR-09", "UR-01"]
bdd: ["BDD-ZFC"]
north_stars: ["NS-3"]
status: planned
---
    # T-01: CLI contract: JSON envelope, typed errors, JSON Schemas, bounded output conventions

    ## Goal
    Define stable public contract for all CLI commands (the tool surface used by the LLM skill).

    ## Deliverables
    - `schemas/` directory with JSON Schema for:
  - envelope (ok/err)
  - snapshot
  - report_hsk
  - review_start/grade
  - audio_process_voice
- CLI conventions:
  - `--json` default for all commands (or explicit)
  - `--limit`, `--max-bytes`
  - truncation behavior: spill to artifact file if needed


    ## Acceptance criteria
    - Each implemented command output validates against its schema
- `--max-bytes` enforced for reports/snapshots
- Errors use typed codes (VALIDATION_ERROR, NOT_FOUND, TOOL_TIMEOUT, POLICY_DENIED, INTERNAL)


    ## Test plan (RGR)
    - Unit: JSON schema validation for envelope
- Integration: run a stub command and validate envelope keys and error code
- Unit/Integration: enforce that forbidden recommendation fields never appear (BDD-ZFC)

